# ~/.zshrc â€” managed by chezmoi

# oh-my-zsh
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="robbyrussell"

plugins=(
  git
  zsh-autosuggestions
  zsh-syntax-highlighting
  docker
  docker-compose
  kubectl
  fzf
)

source "$ZSH/oh-my-zsh.sh"

# ---------- Aliases ----------
alias ll='ls -lAh'
alias la='ls -A'
alias l='ls -CF'
alias g='git'
alias gs='git status'
alias gd='git diff'
alias gc='git commit'
alias gp='git push'
alias gl='git log --oneline --graph'
alias dc='docker compose'
alias k='kubectl'
alias v='nvim'
alias vim='nvim'

{{ if eq .chezmoi.os "linux" -}}
alias open='xdg-open'
alias pbcopy='xclip -selection clipboard'
alias pbpaste='xclip -selection clipboard -o'
{{- end }}

# ---------- PATH ----------
export PATH="$HOME/.local/bin:$HOME/go/bin:$PATH"

{{ if eq .chezmoi.os "darwin" -}}
eval "$(/opt/homebrew/bin/brew shellenv)"
{{- end }}

# ---------- Environment ----------
export EDITOR='nvim'
export VISUAL='nvim'
export LANG='en_US.UTF-8'

# ---------- History ----------
HISTSIZE=50000
SAVEHIST=50000
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_SAVE_NO_DUPS
setopt SHARE_HISTORY

# ---------- Key bindings ----------
bindkey -v
bindkey '^R' history-incremental-search-backward
bindkey '^A' beginning-of-line
bindkey '^E' end-of-line

# ---------- nvm ----------
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && \. "$NVM_DIR/nvm.sh"
[ -s "$NVM_DIR/bash_completion" ] && \. "$NVM_DIR/bash_completion"

# ---------- fzf ----------
[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

# ---------- chezmoi + Bitwarden ----------
chezmoi() {
  if [[ "$1" =~ ^(apply|init|diff|update)$ ]] && [[ -z "${BW_SESSION:-}" ]]; then
    echo "Unlocking Bitwarden..."
    export BW_SESSION=$(bw unlock --raw)
  fi
  command chezmoi "$@"
}

# ---------- Local overrides ----------
[ -f ~/.zshrc.local ] && source ~/.zshrc.local
